<!DOCTYPE html>
<html lang="en">

<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<head>
    <meta charset="utf-8">
<script>
	var moveslist = [];
	var ringSrcLinks = ["<img src=\"Ring 1.jpg\" id=\"ring1\" style=\"position:absolute; width=160px; height=30px;",
						"<img src=\"Ring 2.jpg\" id=\"ring2\" style=\"position:absolute; width=160px; height=30px;",
						"<img src=\"Ring 3.jpg\" id=\"ring3\" style=\"position:absolute; width=160px; height=30px;",
						"<img src=\"Ring 4.jpg\" id=\"ring4\" style=\"position:absolute; width=160px; height=30px;",
						"<img src=\"Ring 5.jpg\" id=\"ring5\" style=\"position:absolute; width=160px; height=30px;",
						"<img src=\"Ring 6.jpg\" id=\"ring6\" style=\"position:absolute; width=160px; height=30px;",
						"<img src=\"Ring 7.jpg\" id=\"ring7\" style=\"position:absolute; width=160px; height=30px;"]
//constants to position the rings correctly
	var topposbase = 555;
	var leftbase = 65;

/**************************************************************  column  ****************************************/

function column(id,count) {
	this.id = id;
	this.count = count;
}
var nRings;
var col1 = new column(1,0);
var col2 = new column(2,0);
var col3 = new column(3,0);
nRingsShowing = 0;
var colcount = [0,0,0,0];
var m = 0;
var counter=0;
var speed = 50;
var doc;

/**************************************************************  addTextToTextbox  ****************************************/
function addTextToTextbox(msg) {
	doc.write(msg);
}

/**************************************************************  updateCounter  ****************************************/
function updateCounter(movearray) {
	counter++;
	document.getElementById("counter").innerHTML = "Number of moves made: "+counter;
}
/**************************************************************  showringInColumn  ****************************************/

function showringInColumn(col,ring) {
	LimgLink = ringincolumnLink(ring,col.id,col.count);
	nRingsShowing++;
	document.getElementById("image"+nRingsShowing).innerHTML = LimgLink;
}

/**************************************************************  ringincolumnLink  ****************************************/

function ringincolumnLink(ring,colno,pos) {
	posstr = "Top:"+(topposbase-(pos)*30)+"px; Left:"+(leftbase+150*(colno-1))+"px;\" />";
	link = ringSrcLinks[ring - 1] + posstr;
	return link;			
}
/**************************************************************  getNextMove  ****************************************/

function getNextMove(){
	m += 1;
	if (m <= moveslist.length) {
	    mov = moveslist[m-1];
		return(mov);
	}
	return({});
}
/**************************************************************  setspeed  ****************************************/
function setspeed(newspeed){
    speed = newspeed;  
	document.getElementById("speedset").innerHTML="speed of animation set at "+speed;
    // or maybe: var whichRadio = document.getElementById(gWhichCheckedId);
    //do somethign with radioVal
}

/**************************************************************  nextAnim  ****************************************/

function nextAnim(movearray){
	ring = movearray[0];
	from = movearray[1];
	to = movearray[2];
	logentry = "ring"+ring+" from "+from+" to "+to;
	if (ring != undefined)
	    addTextToTextbox("<li>Moved ring "+ring+" from "+from+" to "+to+"</li>");
	else
		addTextToTextbox("</ol>");
	elem = $("#ring"+ring);
	up = 300 - 30*(colcount[from]-1);
	uppx = "-="+up+"px"
	sideways = 150*(to-from);
	sidepx = "+="+sideways+"px";
	down = 300- 30*(colcount[to]);
	downpx = "+="+down+"px";
	logentry += " up,side,down,colcountfr,to "+up+","+sideways+","+down+","+colcount[from]+","+colcount[to];
	colcount[from]--;
	colcount[to]++;
	logentry += ", after:"+colcount[from]+","+colcount[to];
	console.log(logentry);
	if (ring != undefined) 
		{updateCounter(movearray);}
	//myRadioFunc();
	//alert("speed set to: "+speed);
//	speed = 300;
	elem.animate({top: uppx},speed).
		animate({left: sidepx},speed).
		animate({top: downpx},speed,function(){nextAnim(getNextMove());});
}
/**************************************************************  ProcessMoves  ****************************************/

	//This is the callback function that parses the response
	function ProcessMoves(xml) {
		var i;
		var list = "";
		var tmove;
		var cmove;
		console.log("in ProcessMoves");
		var xmlDoc = xml.responseXML;
		if (xmlDoc == null) {
			console.log("XMLDOC is null");
		}
		var x = xmlDoc.getElementsByTagName("move");
		console.log(x.length);
		for (i = 0; i <x.length; i++) { 
			cmove = new Array(3);
			tmove = x[i].childNodes[0].nodeValue;
			cmove[0] = Math.floor(tmove/100);
			cmove[1] = Math.floor(tmove/10)%10;
			cmove[2] = tmove%10;
			moveslist[moveslist.length] = cmove;
			console.log(i,moveslist.length,moveslist[moveslist.length-1]);
			list += i+":"+moveslist[moveslist.length-1]+";";
			}
	}
/**************************************************************  getMovesFromServer  ****************************************/
	
	//This the AJAX function that sends the request to the server
	function getMovesFromServer(url,cfunc,n) {
		var xhttp;
		xhttp=new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
		if (xhttp.readyState == 4 && xhttp.status == 200) {
			cfunc(xhttp);
			}
		};
		xhttp.open("GET", url, false);
		xhttp.send();
	}
/****************************************  Cleanup  **********************************************/
	function cleanup() {
	    for (i = 1;i <=7;i++) {
		  ringid = "#ring"+i;
		  $(ringid).remove();
		}
		col1.count = 0;
		col2.count = 0;
		col3.count = 0;
		nRingsShowing = 0;
		for (i = 0;i < 4;i++) 
			colcount[i] = 0;
		m = 0;
		counter=0;
		//console.log("Moveslist before:",moveslist);
		moveslist.splice(0,moveslist.length);
		//console.log("Moveslist After:",moveslist);
		/*doc = document.getElementById("textbox").contentWindow.document;
		doc.open;
		doc.write("");
		doc.close;*/
		var myIFrame = document.getElementById("textbox");
		var content = myIFrame.contentWindow.document.body.innerHTML;    
		content = "";
}
 
/**************************************************************  MoveRings  ****************************************/
	function MoveRings() {
	var i;
	cleanup();
	doc=document.getElementById('textbox').contentWindow.document;
	doc.open();
	x = prompt("Number of rings:","0");
	nRings =  parseInt(x, 10);
	getMovesFromServer('/Tower?rings='+nRings,ProcessMoves,x)
	colcount[1]=nRings;
	for (i = nRings;i >= 1;i--) {
	   col1.count++;
	   showringInColumn(col1,i);
	}
	addTextToTextbox("<h2><center>List of Moves</center></h2><br><ol>");
	mov = getNextMove();
	nextAnim(mov);
	doc.close;
}
/**************************************************************  Showhelp  ****************************************/
function Showhelp() {
	window.open ("help.html","helpwindow","status=1");
}
/* some stuff to use later
This is to position a frame at a specific location:
<div id="contentframe" style="position:relative; top: 160px; left: 0px;">
<iframe src="http://stackoverflow.com" style="height:100%;width:100%;position:absolute;top:0px;bottom:0px;">&lt;/div&gt;
</iframe></div>
for adding text to a frameYou can of course do it one line style:
var doc = document.getElementById('iframe').contentWindow.document;
doc.open();
doc.write('Test');
doc.close();
----- or -----
$("#iframe").contents().find("body").append('Test');
*/
</script>
</head>
<body>
  <center>
  <h1>Tower Of Bramha</h1>
  </center>
  <center>
  <div id="rateOfAnimation";>
    <input type="radio" name="rOA" id="rOA1" value="20" onClick="setspeed(this.value);"> Fast
    <input type="radio" name="rOA" id="rOA2" value="250" onClick="setspeed(this.value);"> Medium
    <input type="radio" name="rOA" id="rOA3" value="500" onClick="setspeed(this.value);"> Slow
  </div>
    <input type="button" onclick="MoveRings()" Value="Submit">
	<input type="button" onclick="Showhelp()" Value="Help">
  </center>
  <h2 id="counter"></h2>
  <iframe scrolling="yes" width="600" height="500"  align="right" src="about:blank" id="textbox"></iframe>
  <div id="maincircus";style="position: absolute; top:150px; left:0px">
  <img src="towers.jpg" id="towers" width="600" height="400" align:left alt="" title=""/>
  <div id="image1"></div>
  <div id="image2"></div>
  <div id="image3"></div>
  <div id="image4"></div>
  <div id="image5"></div>
  <div id="image6"></div>
  <div id="image7"></div>
  </div>
  <div id="myframe";style="position: absolute; top:150px; left:500px">
  </div>
 </body>
</html>
