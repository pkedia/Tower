<!DOCTYPE html>
<html lang="en">

<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<head>
    <meta charset="utf-8">
<script>
	var nRings;
	var col1 = new column(1,0);
	var col2 = new column(2,0);
	var col3 = new column(3,0);
	nRingsShowing = 0;
	var colcount = [0,0,0,0];
	var m = 0;
	var moveslist = [];
	var ringSrcLinks = ["<img src=\"Ring 1.jpg\" id=\"ring1\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 2.jpg\" id=\"ring2\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 3.jpg\" id=\"ring3\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 4.jpg\" id=\"ring4\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 5.jpg\" id=\"ring5\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 6.jpg\" id=\"ring6\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 7.jpg\" id=\"ring7\" style=\"position:absolute; width=165px; height=30px;"]
	var ringSrcLinks = ["<img src=\"Ring 1.jpg\" id=\"ring1\" style=\"position:absolute; width=165px; height=30px;",
	                    "<img src=\"Ring 2.jpg\" id=\"ring2\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 3.jpg\" id=\"ring3\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 4.jpg\" id=\"ring4\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 5.jpg\" id=\"ring5\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 6.jpg\" id=\"ring6\" style=\"position:absolute; width=165px; height=30px;",
						"<img src=\"Ring 7.jpg\" id=\"ring7\" style=\"position:absolute; width=165px; height=30px;"]
	var ringpos = ["Top:280px; Left:65px;\"","Top:310px; Left:65px;\"","Top:340px; Left:65px;\"","Top:370px; Left:65px;\"","Top:400px; Left:65px;\"",
				     "Top:430px; Left:65px;\"","Top:460px; Left:65px;\"",
				     "Top:280px; Left:215px;\"","Top:310px; Left:215px;\"","Top:340px; Left:215px;\"","Top:370px; Left:215px;\"","Top:400px; Left:215px;\"",
				     "Top:430px; Left:215px;\"","Top:460px; Left:215px;\"",
					 "Top:280px; Left:365px;\"","Top:310px; Left:365px;\"","Top:340px; Left:365px;\"","Top:370px; Left:365px;\"","Top:400px; Left:365px;\"",
				     "Top:430px; Left:365px;\"","Top:460px; Left:365px;\"",]
	var topposbase = 460;
	var leftbase = 65;

/**************************************************************  column  ****************************************/

function column(id,count) {
	this.id = id;
	this.count = count;
}

/**************************************************************  showringInColumn  ****************************************/

function showringInColumn(col,ring) {
	LimgLink = ringincolumnLink(ring,col.id,col.count);
	nRingsShowing++;
	document.getElementById("image"+nRingsShowing).innerHTML = LimgLink;
}

/**************************************************************  ringincolumnLink  ****************************************/

function ringincolumnLink(ring,colno,pos) {
	posstr = "Top:"+(topposbase-(7-pos)*30)+"px; Left:"+(leftbase+150*(colno-1))+"px;\"";
	link = ringSrcLinks[ring - 1] + posstr;
	return link;			
}
/**************************************************************  getNextMove  ****************************************/

function getNextMove(){
	m += 1;
	if (m <= moveslist.length) {
	    mov = moveslist[m-1];
		return(mov);
	}
	return({});
}

/**************************************************************  nextAnim  ****************************************/

function nextAnim(movearray){
	ring = movearray[0];
	from = movearray[1];
	to = movearray[2];
	elem = $("#ring"+ring);
	up = 460 - 30*(colcount[from]-1);
	uppx = "-="+up+"px"
	sideways = 150*(to-from);
	sidepx = "+="+sideways+"px";
	down = 460- 30*(colcount[to]);
	downpx = "+="+down+"px";
	colcount[from]--;
	colcount[to]++;
	elem.animate({top: uppx},200).
		animate({left: sidepx},200).
		animate({top: downpx},200,function(){nextAnim(getNextMove());});
}
/**************************************************************  ProcessMoves  ****************************************/

	//This is the callback function that parses the response
	function ProcessMoves(xml) {
		var i;
		var list = "";
		var tmove;
		var cmove;
		console.log("in ProcessMoves");
		var xmlDoc = xml.responseXML;
		if (xmlDoc == null) {
			console.log("XMLDOC is null");
		}
		var x = xmlDoc.getElementsByTagName("move");
		console.log(x.length);
		for (i = 0; i <x.length; i++) { 
			cmove = new Array(3);
			tmove = x[i].childNodes[0].nodeValue;
			cmove[0] = Math.floor(tmove/100);
			cmove[1] = Math.floor(tmove/10)%10;
			cmove[2] = tmove%10;
			moveslist[moveslist.length] = cmove;
			console.log(i,moveslist.length,moveslist[moveslist.length-1]);
			list += moveslist[moveslist.length-1];
			}
	}
/**************************************************************  getMovesFromServer  ****************************************/
	
	//This the AJAX function that sends the request to the server
	function getMovesFromServer(url,cfunc,n) {
		var xhttp;
		xhttp=new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
		if (xhttp.readyState == 4 && xhttp.status == 200) {
			cfunc(xhttp);
			}
		};
		xhttp.open("GET", url, false);
		xhttp.send();
	}
/**************************************************************  MoveRings  ****************************************/
	function MoveRings() {
	var i;
	x = prompt("Number of rings:","0");
	nRings =  parseInt(x, 10);
	getMovesFromServer('/Tower?rings='+nRings,ProcessMoves,x)
	colcount[1]=nRings;
	for (i = nRings;i >= 1;i--) {
	   col1.count++;
	   showringInColumn(col1,i);
	}
	l=moveslist.length;
	mov = getNextMove();
	nextAnim(mov);
}
/**************************************************************  Showhelp  ****************************************/
function Showhelp() {
	window.open ("help.html","helpwindow","status=1");
}
</script>
</head>
<body>
  <center>
  <h1>Tower Of Bramha</h1>
  </center>
  <center>
    <input type="button" onclick="MoveRings()" Value="Submit">
	<input type="button" onclick="Showhelp()" Value="Help">
  </center>
  <div id="maincircus";style="position: absolute; top:150px; left:300px">
  <img src="towers.jpg" id="towers" width="600" height="400" align:center alt="" title="" />
  <div id="image1"></div>
  <div id="image2"></div>
  <div id="image3"></div>
  <div id="image4"></div>
  <div id="image5"></div>
  <div id="image6"></div>
  <div id="image7"></div>
  </div>
</body>
</html>
